<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Command Runner guide &mdash; Ansible Community Documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=5707b69d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/ansible.css?v=c5b67dd2" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/antsibull-minimal.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/rtd-ethical-ads.css?v=289b023e" />

  
    <link rel="shortcut icon" href="../../../../_static/images/Ansible-Mark-RGB_Black.png"/>
    <link rel="canonical" href="https://docs.ansible.com/ansible/latest/collections/community/general/docsite/guide_cmdrunner.html"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../_static/documentation_options.js?v=c7b8e248"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Module Helper guide" href="guide_modulehelper.html" />
    <link rel="prev" title="VarDict Guide" href="guide_vardict.html" /><!-- extra head elements for Ansible beyond RTD Sphinx Theme -->
<script src="https://www.redhat.com/dtm.js"></script>


<!-- <meta class="swiftype" name="published_at" data-type="date" content="2017-12-13" /> -->
<meta class="swiftype" name="version" data-type="string" content="devel">

<!-- Google Tag Manager Data Layer -->
<script>
 dataLayer = [];
</script>
<!-- End Google Tag Manager Data Layer -->



<script>
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','https://s.swiftypecdn.com/install/v2/st.js','_st');

_st('install','yABGvz2N8PwcwBxyfzUc','2.0.0');
</script>

</head>

<body class="wy-body-for-nav"><!-- extra body elements for Ansible beyond RTD Sphinx Theme -->
<!-- Google Tag Manager -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PSB293" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-PSB293');</script>
<!-- End Google Tag Manager -->

<div class="DocSite-globalNav ansibleNav">
  <ul>
    <li><a href="https://www.ansible.com/blog" target="_blank">Blog</a></li>
    <li><a href="https://forum.ansible.com/" target="_blank">Ansible community forum</a></li>
    <li><a href="https://docs.ansible.com/" target="_blank">Documentation</a></li>
  </ul>
</div>

<a class="DocSite-nav" href="/" style="padding-bottom: 30px;">

  <img class="DocSiteNav-logo"
    src="../../../../_static/images/Ansible-Mark-RGB_White.png"
    alt="Ansible Logo">
  <div class="DocSiteNav-title">Ansible Community Documentation</div>
</a>
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Ansible
          </a>
              <div class="version">
                devel
              </div><!--- Based on https://github.com/rtfd/sphinx_rtd_theme/pull/438/files -->

<div class="version">
  
    <form class="version-dropdown" method="get">
      <script>
        function switchVersionTo(slug) {
          var current_url_path = window.location.pathname;
          var url_version = current_url_path.search("/devel/") > -1
            ? "/devel/"
            : "/latest/";
          var new_version_url = current_url_path.replace(url_version, "/" + slug + "/");
          window.location.replace(new_version_url);
        }
      </script>
      <label class="sr-only" for="version-list">Select version:</label>
      <select
          class="version-list"
          id="version-list"
          onchange="switchVersionTo(this.value);"
      >
        
        <option
            value="latest"
            
        >
            latest
        </option>
        
        <option
            value="9"
            
        >
            9
        </option>
        
        <option
            value="2.9"
            
        >
            2.9
        </option>
        
        <option
            value="devel"
            selected="selected"
        >
            devel
        </option>
        
      </select>
    </form>
  
</div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" method="get">
    <label class="sr-only" for="q">Search docs:</label>
    <input type="text" class="st-default-search-input" id="q" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
  
              <p class="caption" role="heading"><span class="caption-text">Ansible getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting started with Ansible</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started_ee/index.html">Getting started with Execution Environments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation, Upgrade &amp; Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation_guide/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../porting_guides/porting_guides.html">Ansible Porting Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../inventory_guide/index.html">Building Ansible inventories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../command_guide/index.html">Using Ansible command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../playbook_guide/index.html">Using Ansible playbooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vault_guide/index.html">Protecting sensitive data with Ansible vault</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../module_plugin_guide/index.html">Using Ansible modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../collections_guide/index.html">Using Ansible collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../os_guide/index.html">Using Ansible on Windows and BSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tips_tricks/index.html">Ansible tips and tricks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing to Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/index.html">Ansible Community Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/contributions_collections.html">Ansible Collections Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/contributions.html">ansible-core Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../community/advanced_index.html">Advanced Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_guide/style_guide/index.html">Ansible documentation style guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending Ansible</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_guide/index.html">Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Common Ansible Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../scenario_guides/cloud_guides.html">Legacy Public Cloud Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Network Automation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../network/getting_started/index.html">Network Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../network/user_guide/index.html">Network Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../network/dev_guide/index.html">Network Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Ansible Galaxy</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../galaxy/user_guide.html">Galaxy User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../galaxy/dev_guide.html">Galaxy Developer Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference &amp; Appendices</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Collection Index</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../amazon/index.html">Collections in the Amazon Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ansible/index.html">Collections in the Ansible Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arista/index.html">Collections in the Arista Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../awx/index.html">Collections in the Awx Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../azure/index.html">Collections in the Azure Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../check_point/index.html">Collections in the Check_point Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../chocolatey/index.html">Collections in the Chocolatey Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cisco/index.html">Collections in the Cisco Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cloud/index.html">Collections in the Cloud Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cloudscale_ch/index.html">Collections in the Cloudscale_ch Namespace</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Collections in the Community Namespace</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../aws/index.html">Community.Aws</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ciscosmb/index.html">Community.Ciscosmb</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../crypto/index.html">Community.Crypto</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../digitalocean/index.html">Community.Digitalocean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dns/index.html">Community.Dns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../docker/index.html">Community.Docker</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Community.General</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../index.html#description">Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#communication">Communication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#changelog">Changelog</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#guides">Guides</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#cloud-guides">Cloud Guides</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../index.html#developer-guides">Developer Guides</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.html#plugin-index">Plugin Index</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../grafana/index.html">Community.Grafana</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hashi_vault/index.html">Community.Hashi_Vault</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hrobot/index.html">Community.Hrobot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../library_inventory_filtering_v1/index.html">Community.Library_Inventory_Filtering_V1</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../libvirt/index.html">Community.Libvirt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mongodb/index.html">Community.Mongodb</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mysql/index.html">Community.Mysql</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../network/index.html">Community.Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../okd/index.html">Community.Okd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../postgresql/index.html">Community.Postgresql</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../proxysql/index.html">Community.Proxysql</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../rabbitmq/index.html">Community.Rabbitmq</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../routeros/index.html">Community.Routeros</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sap_libs/index.html">Community.Sap_Libs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sops/index.html">Community.Sops</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../vmware/index.html">Community.Vmware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../windows/index.html">Community.Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../zabbix/index.html">Community.Zabbix</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../containers/index.html">Collections in the Containers Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cyberark/index.html">Collections in the Cyberark Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dellemc/index.html">Collections in the Dellemc Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../f5networks/index.html">Collections in the F5networks Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fortinet/index.html">Collections in the Fortinet Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../google/index.html">Collections in the Google Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../grafana/index.html">Collections in the Grafana Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../hetzner/index.html">Collections in the Hetzner Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ibm/index.html">Collections in the Ibm Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ieisystem/index.html">Collections in the Ieisystem Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../infinidat/index.html">Collections in the Infinidat Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../infoblox/index.html">Collections in the Infoblox Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../inspur/index.html">Collections in the Inspur Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../junipernetworks/index.html">Collections in the Junipernetworks Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kaytus/index.html">Collections in the Kaytus Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kubernetes/index.html">Collections in the Kubernetes Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kubevirt/index.html">Collections in the Kubevirt Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lowlydba/index.html">Collections in the Lowlydba Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../microsoft/index.html">Collections in the Microsoft Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netapp/index.html">Collections in the Netapp Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netapp_eseries/index.html">Collections in the Netapp_eseries Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netbox/index.html">Collections in the Netbox Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ngine_io/index.html">Collections in the Ngine_io Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openstack/index.html">Collections in the Openstack Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ovirt/index.html">Collections in the Ovirt Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../purestorage/index.html">Collections in the Purestorage Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sensu/index.html">Collections in the Sensu Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../splunk/index.html">Collections in the Splunk Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../t_systems_mms/index.html">Collections in the T_systems_mms Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../telekom_mms/index.html">Collections in the Telekom_mms Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../theforeman/index.html">Collections in the Theforeman Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vmware/index.html">Collections in the Vmware Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vultr/index.html">Collections in the Vultr Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vyos/index.html">Collections in the Vyos Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../wti/index.html">Collections in the Wti Namespace</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../all_plugins.html">Indexes of all modules and plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/playbooks_keywords.html">Playbook Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/common_return_values.html">Return Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/config.html">Ansible Configuration Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/general_precedence.html">Controlling how Ansible behaves: precedence rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/YAMLSyntax.html">YAML Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/python_3_support.html">Python 3 Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/interpreter_discovery.html">Interpreter Discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/release_and_maintenance.html">Releases and maintenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/test_strategies.html">Testing Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev_guide/testing/sanity/index.html">Sanity Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/module_utils.html">Ansible Reference: Module Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/special_variables.html">Special Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/tower.html">Red Hat Ansible Automation Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/automationhub.html">Ansible Automation Hub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference_appendices/logging.html">Logging Ansible output</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Roadmaps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../roadmap/ansible_roadmap_index.html">Ansible Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../roadmap/ansible_core_roadmap_index.html">ansible-core Roadmaps</a></li>
</ul>
<!-- extra nav elements for Ansible beyond RTD Sphinx Theme -->
<!-- changeable widget links to tower - do not change as image controlled by Ansible-->
<div id="sideBanner">
  <br/>
  <a href="https://www.ansible.com/docs-left?utm_source=docs">
    <img style="border-width:0px;" src="https://cdn2.hubspot.net/hubfs/330046/docs-graphics/ASB-docs-left-rail.png" />
  </a>
  <br/><br/><br/>
</div>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Ansible</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Collection Index</a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Collections in the Community Namespace</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Community.General</a></li>
      <li class="breadcrumb-item active">Command Runner guide</li>
  <li class="wy-breadcrumbs-aside">
            <!-- Remove main index page as it is no longer editable -->
            
              <br>

            
  </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script>
    function startsWith(str, needle) {
      return str.slice(0, needle.length) == needle
    }
    function startsWithOneOf(str, needles) {
      return needles.some(function (needle) {
        return startsWith(str, needle);
      });
    }
    var banner = '';
      var extra_banner = '';
    /*use extra_banner for when we want something extra, like a survey or Community Day notice */
   /*  var extra_banner =
      '<div id="latest_extra_banner_id" class="admonition important">' +
        '<p style="padding-bottom: 1.2rem;">' +
        'Discuss Ansible in the new <a href="https://forum.ansible.com/t/welcome-to-the-ansible-community/5">Ansible Forum!</a>' +
        '</p>' +
      '</div>';
      */
    // Create a banner if we're not on the official docs site
    if (location.host == "docs.testing.ansible.com") {
      document.write('<div id="testing_banner_id" class="admonition important">' +
                     '<p>This is the testing site for Ansible Documentation. Unless you are reviewing pre-production changes, please visit the <a href="https://docs.ansible.com/ansible/latest/">official documentation website</a>.</p> <p></p>' +
                     '</div>');
    }
    
      // Create a banner
      current_url_path = window.location.pathname;

      var important = false;
      var msg = '<p>';
      if (startsWith(current_url_path, "/ansible-core/")) {
        msg += 'You are reading documentation for Ansible Core, which contains no plugins except for those in ansible.builtin. For documentation of the Ansible package, go to <a href="/ansible/latest">the latest documentation</a>.';
      } else if (startsWithOneOf(current_url_path, ["/ansible/latest/", "/ansible/10/"])) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'This is the <b>latest</b> (stable) Ansible community documentation. For Red Hat Ansible Automation Platform subscriptions, see <a href="https://access.redhat.com/support/policy/updates/ansible-automation-platform">Life Cycle</a> for version details.';
      } else if (startsWith(current_url_path, "/ansible/2.9/")) {
        msg += 'You are reading the latest Red Hat released version of the Ansible documentation. Community users can use this version, or select <b>latest</b> from the version selector to the left for the most recent community version.';
      } else if (startsWith(current_url_path, "/ansible/devel/")) {
        /* temp extra banner to advertise something */
        banner += extra_banner;

        msg += 'You are reading the <b>devel</b> version of the Ansible documentation - this version is not guaranteed stable. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
      } else {
        msg += 'You are reading an older version of the Ansible documentation. Use the version selection to the left if you want the <b>latest</b> (stable) released version.';
        /* temp extra banner to advertise something - this is for testing*/
        banner += extra_banner;

      }
      msg += '</p>';

      banner += '<div id="banner_id" class="admonition ';
      banner += important ? 'important' : 'caution';
      banner += '">';
      banner += important ? '<br>' : '';
      banner += msg;
      banner += important ? '<br>' : '';
      banner += '</div>';
      document.write(banner);
    
  </script>


  
           <div itemprop="articleBody">
             
  <section id="command-runner-guide">
<span id="ansible-collections-community-general-docsite-guide-cmdrunner"></span><h1>Command Runner guide<a class="headerlink" href="#command-runner-guide" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ansible_collections.community.general.plugins.module_utils.cmd_runner</span></code> module util provides the
<code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> class to help execute external commands. The class is a wrapper around
the standard <code class="docutils literal notranslate"><span class="pre">AnsibleModule.run_command()</span></code> method, handling command arguments, localization setting,
output processing output, check mode, and other features.</p>
<p>It is even more useful when one command is used in multiple modules, so that you can define all options
in a module util file, and each module uses the same runner with different arguments.</p>
<p>For the sake of clarity, throughout this guide, unless otherwise specified, we use the term <em>option</em> when referring to
Ansible module options, and the term <em>argument</em> when referring to the command line arguments for the external command.</p>
<section id="quickstart">
<h3>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> defines a command and a set of coded instructions on how to format
the command-line arguments, in which specific order, for a particular execution.
It relies on <code class="docutils literal notranslate"><span class="pre">ansible.module_utils.basic.AnsibleModule.run_command()</span></code> to actually execute the command.
There are other features, see more details throughout this document.</p>
<p>To use <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> you must start by creating an object. The example below is a simplified
version of the actual code in <a class="reference internal" href="../ansible_galaxy_install_module.html#ansible-collections-community-general-ansible-galaxy-install-module"><span class="std std-ref">community.general.ansible_galaxy_install</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible_collections.community.general.plugins.module_utils.cmd_runner</span> <span class="kn">import</span> <span class="n">CmdRunner</span><span class="p">,</span> <span class="n">cmd_runner_fmt</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">CmdRunner</span><span class="p">(</span>
    <span class="n">module</span><span class="p">,</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;ansible-galaxy&quot;</span><span class="p">,</span>
    <span class="n">arg_formats</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_func</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="n">v</span><span class="p">]),</span>
        <span class="n">galaxy_cmd</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_list</span><span class="p">(),</span>
        <span class="n">upgrade</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_bool</span><span class="p">(</span><span class="s2">&quot;--upgrade&quot;</span><span class="p">),</span>
        <span class="n">requirements_file</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_opt_val</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">),</span>
        <span class="n">dest</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_opt_val</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">),</span>
        <span class="n">force</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_bool</span><span class="p">(</span><span class="s2">&quot;--force&quot;</span><span class="p">),</span>
        <span class="n">no_deps</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_bool</span><span class="p">(</span><span class="s2">&quot;--no-deps&quot;</span><span class="p">),</span>
        <span class="n">version</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_fixed</span><span class="p">(</span><span class="s2">&quot;--version&quot;</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_list</span><span class="p">(),</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This is meant to be done once, then every time you need to execute the command you create a context and pass values as needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the command with these arguments, when values exist for them</span>
<span class="k">with</span> <span class="n">runner</span><span class="p">(</span><span class="s2">&quot;type galaxy_cmd upgrade force no_deps dest requirements_file name&quot;</span><span class="p">,</span> <span class="n">output_process</span><span class="o">=</span><span class="n">process</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
    <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">galaxy_cmd</span><span class="o">=</span><span class="s2">&quot;install&quot;</span><span class="p">,</span> <span class="n">upgrade</span><span class="o">=</span><span class="n">upgrade</span><span class="p">)</span>

<span class="c1"># version is fixed, requires no value</span>
<span class="k">with</span> <span class="n">runner</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
    <span class="n">dummy</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="c1"># Another way of expressing it</span>
<span class="n">dummy</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">runner</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that you can pass values for the arguments when calling <code class="docutils literal notranslate"><span class="pre">run()</span></code>,
otherwise <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> uses the module options with the exact same names to
provide values for the runner arguments. If no value is passed and no module option
is found for the name specified, then an exception is raised, unless the
argument is using <code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_fixed</span></code> as format function like the
<code class="docutils literal notranslate"><span class="pre">version</span></code> in the example above. See more about it below.</p>
<p>In the first example, values of <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">force</span></code>, <code class="docutils literal notranslate"><span class="pre">no_deps</span></code> and others
are taken straight from the module, whilst <code class="docutils literal notranslate"><span class="pre">galaxy_cmd</span></code> and <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> are
passed explicitly.</p>
<p>That generates a resulting command line similar to (example taken from the
output of an integration test):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="s2">&quot;&lt;venv&gt;/bin/ansible-galaxy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;collection&quot;</span><span class="p">,</span>
    <span class="s2">&quot;install&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--upgrade&quot;</span><span class="p">,</span>
    <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
    <span class="s2">&quot;&lt;collection-install-path&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;netbox.netbox&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="argument-formats">
<h2>Argument formats<a class="headerlink" href="#argument-formats" title="Link to this heading"></a></h2>
<p>As seen in the example, <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> expects a parameter named <code class="docutils literal notranslate"><span class="pre">arg_formats</span></code>
defining how to format each CLI named argument.
An “argument format” is nothing but a function to transform the value of a variable
into something formatted for the command line.</p>
<section id="argument-format-function">
<h3>Argument format function<a class="headerlink" href="#argument-format-function" title="Link to this heading"></a></h3>
<p>An <code class="docutils literal notranslate"><span class="pre">arg_format</span></code> function should be of the form:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;--some-param-name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>
</pre></div>
</div>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">value</span></code> can be of any type - although there are convenience
mechanisms to help handling sequence and mapping objects.</p>
<p>The result is expected to be of the type <code class="docutils literal notranslate"><span class="pre">Sequence[str]</span></code> type (most commonly
<code class="docutils literal notranslate"><span class="pre">list[str]</span></code> or <code class="docutils literal notranslate"><span class="pre">tuple[str]</span></code>), otherwise it is considered to be a <code class="docutils literal notranslate"><span class="pre">str</span></code>,
and it is coerced into <code class="docutils literal notranslate"><span class="pre">list[str]</span></code>.
This resulting sequence of strings is added to the command line when that
argument is actually used.</p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">func</span></code> returns:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">[&quot;nee&quot;,</span> <span class="pre">2,</span> <span class="pre">&quot;shruberries&quot;]</span></code>, the command line adds arguments <code class="docutils literal notranslate"><span class="pre">&quot;nee&quot;</span> <span class="pre">&quot;2&quot;</span> <span class="pre">&quot;shruberries&quot;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">==</span> <span class="pre">2</span></code>, the command line adds argument <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">None</span></code>, the command line adds argument <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">[]</span></code>, the command line adds no command line argument for that particular argument.</p></li>
</ul>
</section>
<section id="convenience-format-methods">
<h3>Convenience format methods<a class="headerlink" href="#convenience-format-methods" title="Link to this heading"></a></h3>
<p>In the same module as <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> there is a class <code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt</span></code> which
provides a set of convenience methods that return format functions for common cases.
In the first block of code in the <a class="reference internal" href="#quickstart">Quickstart</a> section you can see the importing of
that class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible_collections.community.general.plugins.module_utils.cmd_runner</span> <span class="kn">import</span> <span class="n">CmdRunner</span><span class="p">,</span> <span class="n">cmd_runner_fmt</span>
</pre></div>
</div>
<p>The same example shows how to make use of some of them in the instantiation of the <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> object.
A description of each one of the convenience methods available and examples of how to use them is found below.
In these descriptions <code class="docutils literal notranslate"><span class="pre">value</span></code> refers to the single parameter passed to the formatting function.</p>
<ul>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_list()</span></code></dt><dd><p>This method does not receive any parameter, function returns <code class="docutils literal notranslate"><span class="pre">value</span></code> as-is.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_list()</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">[&quot;foo&quot;,</span> <span class="pre">&quot;bar&quot;]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;foo&quot;,</span> <span class="pre">&quot;bar&quot;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;foobar&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;foobar&quot;]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_bool()</span></code></dt><dd><p>This method receives two different parameters: <code class="docutils literal notranslate"><span class="pre">args_true</span></code> and <code class="docutils literal notranslate"><span class="pre">args_false</span></code>, latter being optional.
If the boolean evaluation of <code class="docutils literal notranslate"><span class="pre">value</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, the format function returns <code class="docutils literal notranslate"><span class="pre">args_true</span></code>.
If the boolean evaluation is <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the function returns <code class="docutils literal notranslate"><span class="pre">args_false</span></code>
if it was provided, or <code class="docutils literal notranslate"><span class="pre">[]</span></code> otherwise.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_bool(&quot;--force&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;--force&quot;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_bool_not()</span></code></dt><dd><p>This method receives one parameter, which is returned by the function when the boolean evaluation
of <code class="docutils literal notranslate"><span class="pre">value</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_bool_not(&quot;--no-deps&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;--no-deps&quot;]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_optval()</span></code></dt><dd><p>This method receives one parameter <code class="docutils literal notranslate"><span class="pre">arg</span></code>, the function returns the string concatenation
of <code class="docutils literal notranslate"><span class="pre">arg</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code>.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_optval(&quot;-i&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;-i3&quot;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">foobar</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;-ifoobar&quot;]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_opt_val()</span></code></dt><dd><p>This method receives one parameter <code class="docutils literal notranslate"><span class="pre">arg</span></code>, the function returns <code class="docutils literal notranslate"><span class="pre">[arg,</span> <span class="pre">value]</span></code>.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_opt_val(&quot;--name&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">abc</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;--name&quot;,</span> <span class="pre">&quot;abc&quot;]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_opt_eq_val()</span></code></dt><dd><p>This method receives one parameter <code class="docutils literal notranslate"><span class="pre">arg</span></code>, the function returns the string of the form
<code class="docutils literal notranslate"><span class="pre">{arg}={value}</span></code>.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_opt_eq_val(&quot;--num-cpus&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;--num-cpus=10&quot;]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_fixed()</span></code></dt><dd><p>This method receives one parameter <code class="docutils literal notranslate"><span class="pre">arg</span></code>, the function expects no <code class="docutils literal notranslate"><span class="pre">value</span></code> - if one
is provided then it is ignored.
The function returns <code class="docutils literal notranslate"><span class="pre">arg</span></code> as-is.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_fixed(&quot;--version&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;--version&quot;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>57</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;--version&quot;]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Note:</dt><dd><p>This is the only special case in which a value can be missing for the formatting function.
The example also comes from the code in <a class="reference internal" href="#quickstart">Quickstart</a>.
In that case, the module has code to determine the command’s version so that it can assert compatibility.
There is no <em>value</em> to be passed for that CLI argument.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_map()</span></code></dt><dd><p>This method receives one parameter <code class="docutils literal notranslate"><span class="pre">arg</span></code> which must be a dictionary, and an optional parameter <code class="docutils literal notranslate"><span class="pre">default</span></code>.
The function returns the evaluation of <code class="docutils literal notranslate"><span class="pre">arg[value]</span></code>.
If <code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">arg</span></code>, then it returns <code class="docutils literal notranslate"><span class="pre">default</span></code> if defined, otherwise <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p>
<ul>
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_map(dict(a=1,</span> <span class="pre">b=2,</span> <span class="pre">c=3),</span> <span class="pre">default=42)</span></code></p>
</dd>
</dl>
</li>
<li><dl>
<dt>Example:</dt><dd><table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Outcome</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;b&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;2&quot;]</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;yabadabadoo&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">[&quot;42&quot;]</span></code></p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Note:</dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">default</span></code> is not specified, invalid values return an empty list, meaning they are silently ignored.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_func()</span></code></dt><dd><p>This method receives one parameter <code class="docutils literal notranslate"><span class="pre">arg</span></code> which is itself is a format function and it must abide by the rules described above.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Creation:</dt><dd><p><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.as_func(lambda</span> <span class="pre">v:</span> <span class="pre">[]</span> <span class="pre">if</span> <span class="pre">v</span> <span class="pre">==</span> <span class="pre">'stable'</span> <span class="pre">else</span> <span class="pre">['--channel',</span> <span class="pre">'{0}'.format(v)])</span></code></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Note:</dt><dd><p>The outcome for that depends entirely on the function provided by the developer.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="other-features-for-argument-formatting">
<h3>Other features for argument formatting<a class="headerlink" href="#other-features-for-argument-formatting" title="Link to this heading"></a></h3>
<p>Some additional features are available as decorators:</p>
<ul>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.unpack</span> <span class="pre">args()</span></code></dt><dd><p>This decorator unpacks the incoming <code class="docutils literal notranslate"><span class="pre">value</span></code> as a list of elements.</p>
<p>For example, in <code class="docutils literal notranslate"><span class="pre">ansible_collections.community.general.plugins.module_utils.puppet</span></code>, it is used as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@cmd_runner_fmt</span><span class="o">.</span><span class="n">unpack_args</span>
<span class="k">def</span> <span class="nf">execute_func</span><span class="p">(</span><span class="n">execute</span><span class="p">,</span> <span class="n">manifest</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">execute</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;--execute&quot;</span><span class="p">,</span> <span class="n">execute</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">manifest</span><span class="p">]</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">CmdRunner</span><span class="p">(</span>
    <span class="n">module</span><span class="p">,</span>
    <span class="n">command</span><span class="o">=</span><span class="n">_prepare_base_cmd</span><span class="p">(),</span>
    <span class="n">path_prefix</span><span class="o">=</span><span class="n">_PUPPET_PATH_PREFIX</span><span class="p">,</span>
    <span class="n">arg_formats</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="c1"># ...</span>
        <span class="n">_execute</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_func</span><span class="p">(</span><span class="n">execute_func</span><span class="p">),</span>
        <span class="c1"># ...</span>
    <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then, in <a class="reference internal" href="../puppet_module.html#ansible-collections-community-general-puppet-module"><span class="std std-ref">community.general.puppet</span></a> it is put to use with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">runner</span><span class="p">(</span><span class="n">args_order</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
    <span class="n">rc</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">_execute</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;execute&#39;</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;manifest&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.unpack_kwargs()</span></code></dt><dd><p>Conversely, this decorator unpacks the incoming <code class="docutils literal notranslate"><span class="pre">value</span></code> as a <code class="docutils literal notranslate"><span class="pre">dict</span></code>-like object.</p>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">cmd_runner_fmt.stack()</span></code></dt><dd><p>This decorator assumes <code class="docutils literal notranslate"><span class="pre">value</span></code> is a sequence and concatenates the output
of the wrapped function applied to each element of the sequence.</p>
<p>For example, in <a class="reference internal" href="../django_check_module.html#ansible-collections-community-general-django-check-module"><span class="std std-ref">community.general.django_check</span></a>, the argument format for <code class="docutils literal notranslate"><span class="pre">database</span></code>
is defined as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arg_formats</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="c1"># ...</span>
    <span class="n">database</span><span class="o">=</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">cmd_runner_fmt</span><span class="o">.</span><span class="n">as_opt_val</span><span class="p">)(</span><span class="s2">&quot;--database&quot;</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When receiving a list <code class="docutils literal notranslate"><span class="pre">[&quot;abc&quot;,</span> <span class="pre">&quot;def&quot;]</span></code>, the output is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s2">&quot;--database&quot;</span><span class="p">,</span> <span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;--database&quot;</span><span class="p">,</span> <span class="s2">&quot;def&quot;</span><span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
</section>
</section>
<section id="command-runner">
<h2>Command Runner<a class="headerlink" href="#command-runner" title="Link to this heading"></a></h2>
<p>Settings that can be passed to the <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> constructor are:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">module:</span> <span class="pre">AnsibleModule</span></code></dt><dd><p>Module instance. Mandatory parameter.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">command:</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">list[str]</span></code></dt><dd><p>Command to be executed. It can be a single string, the executable name, or a list
of strings containing the executable name as the first element and, optionally, fixed parameters.
Those parameters are used in all executions of the runner.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">arg_formats:</span> <span class="pre">dict</span></code></dt><dd><p>Mapping of argument names to formatting functions.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">default_args_order:</span> <span class="pre">str</span></code></dt><dd><p>As the name suggests, a default ordering for the arguments. When
this is passed, the context can be created without specifying <code class="docutils literal notranslate"><span class="pre">args_order</span></code>. Defaults to <code class="docutils literal notranslate"><span class="pre">()</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">check_rc:</span> <span class="pre">bool</span></code></dt><dd><p>When <code class="docutils literal notranslate"><span class="pre">True</span></code>, if the return code from the command is not zero, the module exits
with an error. Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">path_prefix:</span> <span class="pre">list[str]</span></code></dt><dd><p>If the command being executed is installed in a non-standard directory path,
additional paths might be provided to search for the executable. Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">environ_update:</span> <span class="pre">dict</span></code></dt><dd><p>Pass additional environment variables to be set during the command execution.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">force_lang:</span> <span class="pre">str</span></code></dt><dd><p>It is usually important to force the locale to one specific value, so that responses are consistent and, therefore, parseable.
Please note that using this option (which is enabled by default) overwrites the environment variables <code class="docutils literal notranslate"><span class="pre">LANGUAGE</span></code> and <code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code>.
To disable this mechanism, set this parameter to <code class="docutils literal notranslate"><span class="pre">None</span></code>.
In community.general 9.1.0 a special value <code class="docutils literal notranslate"><span class="pre">auto</span></code> was introduced for this parameter, with the effect
that <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> then tries to determine the best parseable locale for the runtime.
It should become the default value in the future, but for the time being the default value is <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p>
</dd>
</dl>
</li>
</ul>
<p>When creating a context, the additional settings that can be passed to the call are:</p>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">args_order:</span> <span class="pre">str</span></code></dt><dd><p>Establishes the order in which the arguments are rendered in the command line.
This parameter is mandatory unless <code class="docutils literal notranslate"><span class="pre">default_args_order</span></code> was provided to the runner instance.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">output_process:</span> <span class="pre">func</span></code></dt><dd><p>Function to transform the output of the executable into different values or formats.
See examples in section below.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">check_mode_skip:</span> <span class="pre">bool</span></code></dt><dd><p>Whether to skip the actual execution of the command when the module is in check mode.
Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">check_mode_return:</span> <span class="pre">any</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">check_mode_skip=True</span></code>, then return this value instead.</p>
</dd>
</dl>
</li>
</ul>
<p>Additionally, any other valid parameters for <code class="docutils literal notranslate"><span class="pre">AnsibleModule.run_command()</span></code> may be passed, but unexpected behavior
might occur if redefining options already present in the runner or its context creation. Use with caution.</p>
</section>
<section id="processing-results">
<h2>Processing results<a class="headerlink" href="#processing-results" title="Link to this heading"></a></h2>
<p>As mentioned, <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code> uses <code class="docutils literal notranslate"><span class="pre">AnsibleModule.run_command()</span></code> to execute the external command,
and it passes the return value from that method back to caller. That means that,
by default, the result is going to be a tuple <code class="docutils literal notranslate"><span class="pre">(rc,</span> <span class="pre">stdout,</span> <span class="pre">stderr)</span></code>.</p>
<p>If you need to transform or process that output, you can pass a function to the context,
as the <code class="docutils literal notranslate"><span class="pre">output_process</span></code> parameter. It must be a function like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
    <span class="c1"># do some magic</span>
    <span class="k">return</span> <span class="n">processed_value</span>    <span class="c1"># whatever that is</span>
</pre></div>
</div>
<p>In that case, the return of <code class="docutils literal notranslate"><span class="pre">run()</span></code> is the <code class="docutils literal notranslate"><span class="pre">processed_value</span></code> returned by the function.</p>
</section>
<section id="pythonrunner">
<h2>PythonRunner<a class="headerlink" href="#pythonrunner" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">PythonRunner</span></code> class is a specialized version of <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code>, geared towards the execution of
Python scripts. It features two extra and  mutually exclusive parameters <code class="docutils literal notranslate"><span class="pre">python</span></code> and <code class="docutils literal notranslate"><span class="pre">venv</span></code> in its constructor:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansible_collections.community.general.plugins.module_utils.python_runner</span> <span class="kn">import</span> <span class="n">PythonRunner</span>
<span class="kn">from</span> <span class="nn">ansible_collections.community.general.plugins.module_utils.cmd_runner</span> <span class="kn">import</span> <span class="n">cmd_runner_fmt</span>

<span class="n">runner</span> <span class="o">=</span> <span class="n">PythonRunner</span><span class="p">(</span>
    <span class="n">module</span><span class="p">,</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;django&quot;</span><span class="p">],</span>
    <span class="n">arg_formats</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="n">python</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
    <span class="n">venv</span><span class="o">=</span><span class="s2">&quot;/path/to/some/venv&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The default value for <code class="docutils literal notranslate"><span class="pre">python</span></code> is the string <code class="docutils literal notranslate"><span class="pre">python</span></code>, and the for <code class="docutils literal notranslate"><span class="pre">venv</span></code> it is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>The command line produced by such a command with <code class="docutils literal notranslate"><span class="pre">python=&quot;python3.12&quot;</span></code> is something like:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>/usr/bin/python3.12<span class="w"> </span>-m<span class="w"> </span>django<span class="w"> </span>&lt;arg1&gt;<span class="w"> </span>&lt;arg2&gt;<span class="w"> </span>...
</pre></div>
</div>
<p>And the command line for <code class="docutils literal notranslate"><span class="pre">venv=&quot;/work/venv&quot;</span></code> is like:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>/work/venv/bin/python<span class="w"> </span>-m<span class="w"> </span>django<span class="w"> </span>&lt;arg1&gt;<span class="w"> </span>&lt;arg2&gt;<span class="w"> </span>...
</pre></div>
</div>
<p>You may provide the value of the <code class="docutils literal notranslate"><span class="pre">command</span></code> argument as a string (in that case the string is used as a script name)
or as a list, in which case the elements of the list must be valid arguments for the Python interpreter, as in the example above.
See <a class="reference external" href="https://docs.python.org/3/using/cmdline.html">Command line and environment</a> for more details.</p>
<p>If the parameter <code class="docutils literal notranslate"><span class="pre">python</span></code> is an absolute path, or contains directory separators, such as <code class="docutils literal notranslate"><span class="pre">/</span></code>, then it is used
as-is, otherwise the runtime <code class="docutils literal notranslate"><span class="pre">PATH</span></code> is searched for that command name.</p>
<p>Other than that, everything else works as in <code class="docutils literal notranslate"><span class="pre">CmdRunner</span></code>.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 4.8.0.</span></p>
</div>
</section>
</section>


           </div>
          </div>
          

<footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="guide_vardict.html" class="btn btn-neutral float-left" title="VarDict Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="guide_modulehelper.html" class="btn btn-neutral float-right" title="Module Helper guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Ansible project contributors.
      <span class="lastupdated">Last updated on Sep 10, 2024.
      </span></p>
  </div>

  
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script><!-- extra footer elements for Ansible beyond RTD Sphinx Theme -->
<!-- begin analytics -->
<script>
var _hsq = _hsq || [];
_hsq.push(["setContentType", "standard-page"]);
      (function(d,s,i,r) {
      if (d.getElementById(i)){return;}
      var n = d.createElement(s),e = document.getElementsByTagName(s)[0];
      n.id=i;n.src = 'https://js.hs-analytics.net/analytics/'+(Math.ceil(new Date()/r)*r)+'/330046.js';
      e.parentNode.insertBefore(n, e);
      })(document, "script", "hs-analytics",300000);
</script>
<!-- end analytics -->
<script>
if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
  _satellite.pageBottom();
}
</script>

</body>
</html>